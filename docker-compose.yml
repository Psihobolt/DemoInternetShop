version: "3.9"
networks:
  my-network:
    driver: bridge

services:
  dis-web:
    container_name: dis-web
    depends_on:
      - "dis-products-api"
    build: 
      context: ./web/.
      dockerfile: Dockerfile
    volumes:
      - ./web:/app
      - "/app/node_modules"
    ports:
      - "4200:4200"
    networks:
      - my-network
    restart: always
  
  dis-products-api:
    container_name: dis-products-api
    build: 
      context: ./backend/DemoInternetShop.ProductsAPI/.
      dockerfile: Dockerfile
    volumes:
      - ./backend/DemoInternetShop.ProductsAPI:/app
      - ./backend/DemoInternetShop.ProductsAPI:/src
    ports:
      - "5050:5050"
    environment:
      DOTNET_USE_POLLING_FILE_WATCHER: 1
      ASPNETCORE_LOGGING__CONSOLE__DISABLECOLORS: "true"
      ASPNETCORE_ENVIRONMENT: "Development"
      ASPNETCORE_URLS: "http://0.0.0.0:5050"
    networks:
      - my-network
    restart: always

  dis-proxy:
    container_name: dis-proxy
    build: 
      context: ./proxy/.
      dockerfile: Dockerfile
    ports:
      - "80:80"
    links:
      - dis-products-api:dis-products-api
      - dis-web:dis-web
    depends_on:
      - "dis-products-api"
      - "dis-web"
    networks:
      - my-network
    restart: always
    